{% extends 'base.html' %}
{% load static %}

{% block content %} 


<!-- BREADCRUMB -->
<div id="breadcrumb" class="section">
    <!-- container -->
    <div class="container">
        <!-- row -->
        <div class="row">
            <div class="col-md-12">
                <ul class="breadcrumb-tree">	
                    <li><a href="{% url 'index' %}">Home</a></li>
                    <li class="active">Account Detail</li>
                </ul>
            </div>
        </div>
        <!-- /row -->
    </div>
    <!-- /container -->
</div>
<!-- /BREADCRUMB -->


<div class="container">
    <div class="row row-reverse">
        <div class="col-md-12">
            <h3 class="">Account Details</h3>
            <div class="panel panel-default">
                <div class="panel-body acc">
                    <div class="row">
                        <!-- Left column for detail -->
                        <div class="col-md-6 ">
                            <div class="detail">
                                <p><strong>UserName:</strong> {{user.username}}</p>
                                <p><strong>Name:</strong> {{user.first_name}} {{user.last_name}}</p>
                                <p><strong>Email:</strong> {{user.email}}</p>
                                <p><strong>Phone:</strong>+91-{{user.mobile_number}}</p>
                                <button class="primary-btn cta-btn" data-toggle="modal" data-target="#editModal1">Edit Details</button>
                            </div>
                        </div>
    
                        <!-- Right column for img -->
                        <div class="col-md-6 col-xs-12">
                            <div class="img text-center">
                                <img src="{% static 'img/user.png' %}" alt="" height="150px">
                                <p><strong>Last Login:</strong> {{user.last_login}}</p>
                                <button class="primary-btn cta-btn" data-toggle="modal" data-target="#editModal2">Change Password</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-12">
            <h3 class="">Billing Details</h3>
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table table-hover " id="billingTable">
                            <thead>
                                <tr >
                                    <th>Id</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Address</th>
                                    <th>City</th>
                                    <th>State</th>
                                    <th>Country</th>
                                    <th>Pincode</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in billingAddress %}
                                <tr data-id="{{user.id}}" class="billing-row" data-addresstype="billing">
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ forloop.counter }}</td>
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ user.first_name }} {{ user.last_name }}</td>
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ user.email }}</td>
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ user.address }}</td>
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ user.city }}</td>
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ user.state }}</td>
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ user.country }}</td>
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ user.pincode }}</td>   
                                    <td class="text-center">
                                        <a href="#" class="delete-address">
                                            <i class="fa fa-trash fa-lg text-danger" aria-hidden="true"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <h3 class="">Shipping Address Details</h3>
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="billingTable">
                            <thead>
                                <tr>
                                    <th>Id</th>
                                    <th> Name</th>
                                    <th>Email</th>
                                    <th>Address</th>
                                    <th>City</th>
                                    <th>State</th>
                                    <th>Country</th>
                                    <th>Pincode</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in shippingAddresses %}
                                <tr data-id="{{user.id}}" data-addresstype="shipping" class="shipping-row">
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ forloop.counter }}</td>
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ user.first_name }} {{ user.last_name }}</td>
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ user.email }}</td>
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ user.address }}</td>
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ user.city }}</td>
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ user.state }}</td>
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ user.country }}</td>
                                    <td data-toggle="modal" data-target="#editModal3" data-id="{{ user.id }}">{{ user.pincode }}</td>
                                    <td class="text-center">
                                        <a href="#" class="delete-address">
                                            <i class="fa fa-trash fa-lg text-danger" aria-hidden="true"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit billing Modal -->
    <div class="modal fade" id="editModal3" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit User Details</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            <div id="msg" class="mt-3"></div>

                <form id="editUserForm" data-id="" data-addresstype="" action="" method="post">
                <div class="modal-body">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="editName">First Name</label>
                                    <input type="text" class="form-control" name="first-name" id="firstName" placeholder="Enter your First name">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="editName">Last Name</label>
                                    <input type="text" class="form-control" name="last-name" id="lastName" placeholder="Enter your Last name">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="editEmail">Email</label>
                            <input type="email" class="form-control"  name="editemail" id="editemail" placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label for="editmob">Address</label>
                            <input type="Text" class="form-control" name="address" id="editadd" name="mob" placeholder="Enter your Address">
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="editmob">City</label>
                                    <input type="Text" class="form-control" name="city" id="editcity" name="mob" placeholder="Enter your City">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="editmob">State</label>
                                    <input type="Text" class="form-control" name="state" id="editstate" name="mob" placeholder="Enter your State">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="editmob">Country</label>
                                    <input list="countrylist" class="form-control" name="country" id="editcountry" name="mob" placeholder="Enter your Country">
                                    <datalist id="countrylist">
                                        <option value="Afghanistan" />
                                        <option value="Albania" />
                                        <option value="Algeria" />
                                        <option value="American Samoa" />
                                        <option value="Andorra" />
                                        <option value="Angola" />
                                        <option value="Anguilla" />
                                        <option value="Antarctica" />
                                        <option value="Antigua and Barbuda" />
                                        <option value="Argentina" />
                                        <option value="Armenia" />
                                        <option value="Aruba" />
                                        <option value="Australia" />
                                        <option value="Austria" />
                                        <option value="Azerbaijan" />
                                        <option value="Bahamas" />
                                        <option value="Bahrain" />
                                        <option value="Bangladesh" />
                                        <option value="Barbados" />
                                        <option value="Belarus" />
                                        <option value="Belgium" />
                                        <option value="Belize" />
                                        <option value="Benin" />
                                        <option value="Bermuda" />
                                        <option value="Bhutan" />
                                        <option value="Bolivia" />
                                        <option value="Bosnia and Herzegovina" />
                                        <option value="Botswana" />
                                        <option value="Bouvet Island" />
                                        <option value="Brazil" />
                                        <option value="British Indian Ocean Territory" />
                                        <option value="Brunei Darussalam" />
                                        <option value="Bulgaria" />
                                        <option value="Burkina Faso" />
                                        <option value="Burundi" />
                                        <option value="Cambodia" />
                                        <option value="Cameroon" />
                                        <option value="Canada" />
                                        <option value="Cape Verde" />
                                        <option value="Cayman Islands" />
                                        <option value="Central African Republic" />
                                        <option value="Chad" />
                                        <option value="Chile" />
                                        <option value="China" />
                                        <option value="Christmas Island" />
                                        <option value="Cocos (Keeling) Islands" />
                                        <option value="Colombia" />
                                        <option value="Comoros" />
                                        <option value="Congo" />
                                        <option value="Congo, The Democratic Republic of The" />
                                        <option value="Cook Islands" />
                                        <option value="Costa Rica" />
                                        <option value="Cote D'ivoire" />
                                        <option value="Croatia" />
                                        <option value="Cuba" />
                                        <option value="Cyprus" />
                                        <option value="Czech Republic" />
                                        <option value="Denmark" />
                                        <option value="Djibouti" />
                                        <option value="Dominica" />
                                        <option value="Dominican Republic" />
                                        <option value="Ecuador" />
                                        <option value="Egypt" />
                                        <option value="El Salvador" />
                                        <option value="Equatorial Guinea" />
                                        <option value="Eritrea" />
                                        <option value="Estonia" />
                                        <option value="Ethiopia" />
                                        <option value="Falkland Islands (Malvinas)" />
                                        <option value="Faroe Islands" />
                                        <option value="Fiji" />
                                        <option value="Finland" />
                                        <option value="France" />
                                        <option value="French Guiana" />
                                        <option value="French Polynesia" />
                                        <option value="French Southern Territories" />
                                        <option value="Gabon" />
                                        <option value="Gambia" />
                                        <option value="Georgia" />
                                        <option value="Germany" />
                                        <option value="Ghana" />
                                        <option value="Gibraltar" />
                                        <option value="Greece" />
                                        <option value="Greenland" />
                                        <option value="Grenada" />
                                        <option value="Guadeloupe" />
                                        <option value="Guam" />
                                        <option value="Guatemala" />
                                        <option value="Guinea" />
                                        <option value="Guinea-bissau" />
                                        <option value="Guyana" />
                                        <option value="Haiti" />
                                        <option value="Heard Island and Mcdonald Islands" />
                                        <option value="Holy See (Vatican City State)" />
                                        <option value="Honduras" />
                                        <option value="Hong Kong" />
                                        <option value="Hungary" />
                                        <option value="Iceland" />
                                        <option value="India" />
                                        <option value="Indonesia" />
                                        <option value="Iran, Islamic Republic of" />
                                        <option value="Iraq" />
                                        <option value="Ireland" />
                                        <option value="Israel" />
                                        <option value="Italy" />
                                        <option value="Jamaica" />
                                        <option value="Japan" />
                                        <option value="Jordan" />
                                        <option value="Kazakhstan" />
                                        <option value="Kenya" />
                                        <option value="Kiribati" />
                                        <option value="Korea, Democratic People's Republic of" />
                                        <option value="Korea, Republic of" />
                                        <option value="Kuwait" />
                                        <option value="Kyrgyzstan" />
                                        <option value="Lao People's Democratic Republic" />
                                        <option value="Latvia" />
                                        <option value="Lebanon" />
                                        <option value="Lesotho" />
                                        <option value="Liberia" />
                                        <option value="Libyan Arab Jamahiriya" />
                                        <option value="Liechtenstein" />
                                        <option value="Lithuania" />
                                        <option value="Luxembourg" />
                                        <option value="Macao" />
                                        <option value="Macedonia, The Former Yugoslav Republic of" />
                                        <option value="Madagascar" />
                                        <option value="Malawi" />
                                        <option value="Malaysia" />
                                        <option value="Maldives" />
                                        <option value="Mali" />
                                        <option value="Malta" />
                                        <option value="Marshall Islands" />
                                        <option value="Martinique" />
                                        <option value="Mauritania" />
                                        <option value="Mauritius" />
                                        <option value="Mayotte" />
                                        <option value="Mexico" />
                                        <option value="Micronesia, Federated States of" />
                                        <option value="Moldova, Republic of" />
                                        <option value="Monaco" />
                                        <option value="Mongolia" />
                                        <option value="Montserrat" />
                                        <option value="Morocco" />
                                        <option value="Mozambique" />
                                        <option value="Myanmar" />
                                        <option value="Namibia" />
                                        <option value="Nauru" />
                                        <option value="Nepal" />
                                        <option value="Netherlands" />
                                        <option value="Netherlands Antilles" />
                                        <option value="New Caledonia" />
                                        <option value="New Zealand" />
                                        <option value="Nicaragua" />
                                        <option value="Niger" />
                                        <option value="Nigeria" />
                                        <option value="Niue" />
                                        <option value="Norfolk Island" />
                                        <option value="Northern Mariana Islands" />
                                        <option value="Norway" />
                                        <option value="Oman" />
                                        <option value="Pakistan" />
                                        <option value="Palau" />
                                        <option value="Palestinian Territory, Occupied" />
                                        <option value="Panama" />
                                        <option value="Papua New Guinea" />
                                        <option value="Paraguay" />
                                        <option value="Peru" />
                                        <option value="Philippines" />
                                        <option value="Pitcairn" />
                                        <option value="Poland" />
                                        <option value="Portugal" />
                                        <option value="Puerto Rico" />
                                        <option value="Qatar" />
                                        <option value="Reunion" />
                                        <option value="Romania" />
                                        <option value="Russian Federation" />
                                        <option value="Rwanda" />
                                        <option value="Saint Helena" />
                                        <option value="Saint Kitts and Nevis" />
                                        <option value="Saint Lucia" />
                                        <option value="Saint Pierre and Miquelon" />
                                        <option value="Saint Vincent and The Grenadines" />
                                        <option value="Samoa" />
                                        <option value="San Marino" />
                                        <option value="Sao Tome and Principe" />
                                        <option value="Saudi Arabia" />
                                        <option value="Senegal" />
                                        <option value="Serbia and Montenegro" />
                                        <option value="Seychelles" />
                                        <option value="Sierra Leone" />
                                        <option value="Singapore" />
                                        <option value="Slovakia" />
                                        <option value="Slovenia" />
                                        <option value="Solomon Islands" />
                                        <option value="Somalia" />
                                        <option value="South Africa" />
                                        <option value="South Georgia and The South Sandwich Islands" />
                                        <option value="Spain" />
                                        <option value="Sri Lanka" />
                                        <option value="Sudan" />
                                        <option value="Suriname" />
                                        <option value="Svalbard and Jan Mayen" />
                                        <option value="Swaziland" />
                                        <option value="Sweden" />
                                        <option value="Switzerland" />
                                        <option value="Syrian Arab Republic" />
                                        <option value="Taiwan, Province of China" />
                                        <option value="Tajikistan" />
                                        <option value="Tanzania, United Republic of" />
                                        <option value="Thailand" />
                                        <option value="Timor-leste" />
                                        <option value="Togo" />
                                        <option value="Tokelau" />
                                        <option value="Tonga" />
                                        <option value="Trinidad and Tobago" />
                                        <option value="Tunisia" />
                                        <option value="Turkey" />
                                        <option value="Turkmenistan" />
                                        <option value="Turks and Caicos Islands" />
                                        <option value="Tuvalu" />
                                        <option value="Uganda" />
                                        <option value="Ukraine" />
                                        <option value="United Arab Emirates" />
                                        <option value="United Kingdom" />
                                        <option value="United States" />
                                        <option value="United States Minor Outlying Islands" />
                                        <option value="Uruguay" />
                                        <option value="Uzbekistan" />
                                        <option value="Vanuatu" />
                                        <option value="Venezuela" />
                                        <option value="Viet Nam" />
                                        <option value="Virgin Islands, British" />
                                        <option value="Virgin Islands, U.S" />
                                        <option value="Wallis and Futuna" />
                                        <option value="Western Sahara" />
                                        <option value="Yemen" />
                                        <option value="Zambia" />
                                        <option value="Zimbabwe" />
                                    </datalist>
                                    
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="editmob">Pincode</label>
                                    <input type="Text" class="form-control" name="pincode" id="editpin" name="mob" placeholder="Enter your Pincode">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn primary-btn cta-btn">Save Changes</button>
                        
                    </div>
                </form>
            </div>
        </div>
    </div>
    
</div>

<!-- Edit Account Detail Modal -->
<div class="modal fade" id="editModal1" tabindex="-1" role="dialog" aria-labelledby="editModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="editModalLabel">Edit Account Details</h4>
            </div>
            <div id="editUserDetailsMessage" class="mt-3"></div>

            <div class="modal-body">
                <!-- Add your form fields for editing here -->
                <form action="{% url 'editdetail' %}" method="post" id="editUserDetailsForm">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="editName">First Name</label>
                        <input type="text" class="form-control" id="editName" name="first-name" placeholder="Enter your First name" value="{{request.user.first_name}}">
                    </div>
                    <div class="form-group">
                        <label for="editName">Last Name</label>
                        <input type="text" class="form-control" id="editName" name="last-name" placeholder="Enter your Last name" value="{{request.user.last_name}}">
                    </div>
                    <div class="form-group">
                        <label for="editEmail">Email</label>
                        <input type="email" class="form-control" id="" name="email" placeholder="Enter your email" value="{{request.user.email}}">
                    </div>
                    <div class="form-group">
                        <label for="editmob">Mob No.</label>
                        <input type="text" class="form-control" id="editmob" name="mob" placeholder="Enter your Mobile Number" value="{{request.user.mobile_number}}">
                    </div>
                    <!-- Add more fields as needed -->

                    <button type="submit" class="btn primary-btn cta-btn">Save Changes</button>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Edit Password Modal -->
<div class="modal fade" id="editModal2" tabindex="-1" role="dialog" aria-labelledby="editModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="editModalLabel">Change Password</h4>
            </div>
            <div id="passwordChangeMessage" class="mt-3"></div>
            <div class="modal-body">
                <!-- Add your form fields for editing here -->
                <form action="{% url 'changepsd' %}" id="passwordChangeForm" method="post">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="oldpsd">Old Password</label>
                        <input type="text" class="form-control" id="oldpsd" name="oldpsd" placeholder="Enter your Old Password" required>
                    </div>
                    <div class="form-group">
                        <label for="newpsd">New Password</label>
                        <input type="text" class="form-control" id="newpsd" name="newpsd" placeholder="Enter New Password" required>
                    </div>
                    <div class="form-group">
                        <label for="cpsd" >Confirm New Password</label>
                        <input type="text" class="form-control" id="cpsd" name="cnewpsd" placeholder="Enter Confirm New Password" required>
                    </div>
                    <!-- Add more fields as needed -->

                    <button type="submit" class="btn primary-btn cta-btn">Save Changes</button>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        // Function to handle modal submission
        function handleModalSubmission(formId, modalId, successMessageId) {
            $(formId).submit(function (event) {
                event.preventDefault();

                $.ajax({
                    type: "POST",
                    url: $(this).attr('action'),
                    data: $(this).serialize(),
                    success: function (data) {
                        if (data.status === "success") {
                            $(successMessageId).html('<div class="alert alert-success">' + data.message + '</div>');
                            setTimeout(function () {
                                $(modalId).modal('hide');
                                location.reload();
                            }, 3000);
                            
                        } else {
                            $(successMessageId).html('<div class="alert alert-danger">' + data.message + '</div>');
                        }
                    },
                    error: function (error) {
                        $(successMessageId).html('<div class="alert alert-danger">' + error + '</div>');
                        console.log(error);
                    }
                });
            });
        }

        // Handle Account Details modal
        handleModalSubmission("#accountDetailsForm", "#editModal3", "#accountDetailsMessage");

        // Handle Password Change modal
        handleModalSubmission("#passwordChangeForm", "#editModal2", "#passwordChangeMessage");

        // Handle Edit User Details modal
        handleModalSubmission("#editUserDetailsForm", "#editModal1", "#editUserDetailsMessage");
    });


    $(document).ready(function () {
        // Handle delete address click
        $('#billingTable, #shippingTable').on('click', 'a.delete-address', function (e) {
            e.preventDefault();
    
            var addressId = $(this).closest('tr').data('id');
            var isBillingRow = $(this).closest('tr').hasClass('billing-row');
            var isShippingRow = $(this).closest('tr').hasClass('shipping-row');
            var deleteUrl = isBillingRow
                ? '/deletebillingaddress/' + addressId + '/'
                : (isShippingRow ? '/deleteshippingaddress/' + addressId + '/' : '');
    
            if (!deleteUrl) {
                console.error('Invalid address type');
                return;
            }
    
            // Send AJAX request to delete the address
            $.ajax({
                type: 'POST',
                url: deleteUrl,
                data: { csrfmiddlewaretoken: '{{ csrf_token }}' },
                success: function (data) {
                    if (data.status === 'success') {
                        // Remove the deleted row from the table
                        $('#billingTable, #shippingTable').find('tr[data-id="' + addressId + '"]').remove();
                    } else {
                        console.error('Failed to delete address');
                    }
                },
                error: function () {
                    console.error('Error in AJAX request');
                }
            });
        });
    });
    
    $(document).ready(function () {
        // Attach a click event to rows with the class 'billing-row' or 'shipping-row'
        $('.billing-row, .shipping-row').click(function () {
            // Get the data-id attribute from the clicked row
            var userId = $(this).data('id');
            var addresstype = $(this).data('addresstype');
    
            // Set the form attributes for later use
            $('#editUserForm').attr('data-id', userId);
            $('#editUserForm').attr('data-addresstype', addresstype);
    
            var addresses;
            var formAction;
    
            if (addresstype === 'billing') {
                addresses = JSON.parse('{{ billing_addresses_json|escapejs }}');
                formAction = '{% url "editbillingaddress" pk=0 %}'.replace('0', userId);
            } else if (addresstype === 'shipping') {
                addresses = JSON.parse('{{ shipping_addresses_json|escapejs }}');
                formAction = '{% url "editshippingaddress" pk=0 %}'.replace('0', userId);
            }
    
            // Set the form action dynamically
            $('#editUserForm').attr('action', formAction);
    
            var user = addresses.find(function (element) {
                return element.pk == userId;
            });
    
            // Fill in the form fields in the modal with user details
            $('#firstName').val(user.fields.first_name);
            $('#lastName').val(user.fields.last_name);
            $('#editemail').val(user.fields.email);
            $('#editadd').val(user.fields.address);
            $('#editcity').val(user.fields.city);
            $('#editstate').val(user.fields.state);
            $('#editcountry').val(user.fields.country);
            $('#editpin').val(user.fields.pincode);
            // Repeat the above line for other fields
        });
    
        // Handle form submission
        $('#editUserForm').submit(function (event) {
            event.preventDefault();
    
            // Get the user ID and address type from the form's data attributes
            var userId = $(this).data('id');
            var addresstype = $(this).data('addresstype');
    
            // Get the form data
            var formData = $(this).serialize();
    
            // Get the form action URL dynamically
            var formAction = $(this).attr('action');
    
            // Send an AJAX request to the server to save changes
            $.ajax({
                type: "POST",
                url: formAction,
                data: formData,
                success: function (data) {
                    // Handle success response as needed
                    if (data.status === "success") {
                        $('#msg').html('<div class="alert alert-success">' + data.message + '</div>');
                        setTimeout(function () {
                            $('#editModal3').modal('hide');
                            location.reload();
                        }, 3000);
                    } else {
                        $('#msg').html('<div class="alert alert-danger">' + data.message + '</div>');
                    }
                    console.log(data);
                },
                error: function (error) {
                    // Handle error response as needed
                    console.error(error);
                }
            });
    
            // Close the modal after submission
        });
    });
    
</script>




{% endblock %}
